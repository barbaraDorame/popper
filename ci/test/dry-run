#!/bin/bash
set -ex

source ./common
init_test_repo
cd $test_repo_path

git clone https://github.com/cplee/github-actions-demo
cd github-actions-demo
git checkout c824a5a

export PHONY_SECRET=foo

# delete any containers that might exist
docker rm $(docker ps -aq) || true

dry_num_lines=$(popper run --dry-run | grep 'DRYRUN' | wc -l)

# 5 actions, at least one line per action
test $dry_num_lines -gt 5

# test that no containers are running
test -z "$(docker ps -aq)"
